<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Radio Record –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä</title>
  <style>
    * { box-sizing: border-box; }
    body {
      background: linear-gradient(160deg, #000 0%, #1a1a1a 100%);
      color: #0f0;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }

    .player {
      background: #111;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 0 25px rgba(0, 255, 0, 0.2);
      width: 100%;
      max-width: 400px;
      margin-bottom: 20px;
    }

    .title {
      font-size: 1.6em;
      font-weight: bold;
      background: linear-gradient(to right, #0f0, #0ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    select {
      width: 100%;
      padding: 8px;
      background: #000;
      border: 1px solid #0f0;
      color: #0f0;
      border-radius: 5px;
      margin: 10px 0;
    }

    .controls {
      margin: 15px 0;
    }

    .controls button {
      background: #000;
      border: 1px solid #0f0;
      color: #0f0;
      font-size: 1.6em;
      margin: 0 10px;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }

    .controls button:hover {
      background: #0f0;
      color: #000;
    }

    .volume-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }

    input[type="range"] {
      width: 100%;
    }

    .status {
      margin-top: 10px;
      font-size: 0.9em;
      color: #8f8;
    }

    canvas {
      border: 1px solid #0f0;
      background: #000;
      margin: 10px 0;
      width: 100%;
      max-width: 600px;
      border-radius: 4px;
    }

    .label {
      margin-bottom: 10px;
      color: #aaa;
      font-size: 0.85em;
    }

    @media (max-width: 480px) {
      .controls button {
        font-size: 1.3em;
        padding: 6px 10px;
      }
      .title {
        font-size: 1.3em;
      }
    }
  </style>
</head>
<body>

  <div class="player">
    <div class="title">üéß Radio Record</div>
    <select id="channelSelect"></select>
    <audio id="radio" crossorigin="anonymous" preload="none"></audio>

    <div class="controls">
      <button id="playBtn">‚ñ∂Ô∏è</button>
      <button id="pauseBtn">‚è∏Ô∏è</button>
      <button id="stopBtn">‚èπÔ∏è</button>
    </div>

    <div class="volume-container">
      <span>üîä</span>
      <input type="range" id="volume" min="0" max="1" step="0.01" value="1">
    </div>

    <div class="status" id="status">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
  </div>

  <canvas id="waveCanvas" height="150"></canvas>
  <div class="label">üìà –í–æ–ª–Ω–∞ –∑–≤—É–∫–∞</div>

  <canvas id="freqCanvas" height="150"></canvas>
  <div class="label">üìä –°–ø–µ–∫—Ç—Ä —á–∞—Å—Ç–æ—Ç</div>

  <canvas id="bufferCanvas" height="100"></canvas>
  <div class="label">üì∂ –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è / —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å</div>

  <script>
    const channels = {
      "Record (–æ—Å–Ω–æ–≤–Ω–æ–π —ç—Ñ–∏—Ä)": "https://radiorecord.hostingradio.ru/rr_main96.aacp",
      "Tiesto": "https://radiorecord.hostingradio.ru/tiesto96.aacp",
      "David Guetta": "https://radiorecord.hostingradio.ru/guetta96.aacp",
      "Armin van Buuren": "https://radiorecord.hostingradio.ru/armin96.aacp",
      "Russian Mix": "https://radiorecord.hostingradio.ru/rus96.aacp",
      "–°—É–ø–µ—Ä–¥–∏—Å–∫–æ—Ç–µ–∫–∞ 90-—Ö": "https://radiorecord.hostingradio.ru/sd9096.aacp",
      "Chill-Out": "https://radiorecord.hostingradio.ru/chil96.aacp",
      "Deep": "https://radiorecord.hostingradio.ru/deep96.aacp",
      "Pirate Station": "https://radiorecord.hostingradio.ru/ps96.aacp",
      "Trancemission": "https://radiorecord.hostingradio.ru/tm96.aacp",
      "Record 80-—Ö": "https://radiorecord.hostingradio.ru/198096.aacp",
      "Record 00-—Ö": "https://radiorecord.hostingradio.ru/200096.aacp",
      "Chill House": "https://radiorecord.hostingradio.ru/chillhouse96.aacp",
      "Bass House": "https://radiorecord.hostingradio.ru/jackin96.aacp",
      "10's Dance": "https://radiorecord.hostingradio.ru/201096.aacp",
      "Lo-Fi": "https://radiorecord.hostingradio.ru/lofi96.aacp",
      "Workout": "https://radiorecord.hostingradio.ru/workout96.aacp",
      "Dubstep": "https://radiorecord.hostingradio.ru/dub96.aacp",
      "Trap": "https://radiorecord.hostingradio.ru/trap96.aacp",
      "Synthwave": "https://radiorecord.hostingradio.ru/synth96.aacp",
      "Hardstyle": "https://radiorecord.hostingradio.ru/teo96.aacp",
      "Dream Dance": "https://radiorecord.hostingradio.ru/dream96.aacp",
      "Trance Classics": "https://radiorecord.hostingradio.ru/trancehits96.aacp",
      "TOP 100 EDM": "https://radiorecord.hostingradio.ru/top100edm96.aacp",
      "GOA/PSY": "https://radiorecord.hostingradio.ru/goa96.aacp",
      "Reggae": "https://radiorecord.hostingradio.ru/reggae96.aacp",
      "Disco/Funk": "https://radiorecord.hostingradio.ru/discofunk96.aacp",
      "House Hits": "https://radiorecord.hostingradio.ru/househits96.aacp",
      "EDM Classics": "https://radiorecord.hostingradio.ru/edmhits96.aacp",
      "Live DJ-sets": "https://radiorecord.hostingradio.ru/livedjsets96.aacp",
      "Summer Dance": "https://radiorecord.hostingradio.ru/summerparty96.aacp",
      "Summer Lounge": "https://radiorecord.hostingradio.ru/summerlounge64.aacp",
      "Christmas": "https://radiorecord.hostingradio.ru/christmas96.aacp",
      "Christmas Chill": "https://radiorecord.hostingradio.ru/christmaschill96.aacp",
      "–ù–∞ –•–∞–π–ø–µ": "https://radiorecord.hostingradio.ru/hype96.aacp",
      "Phonk": "https://radiorecord.hostingradio.ru/phonk96.aacp",
      "Rap Hits": "https://radiorecord.hostingradio.ru/rap96.aacp",
      "Rap Classics": "https://radiorecord.hostingradio.ru/rapclassics96.aacp",
      "VIP House": "https://radiorecord.hostingradio.ru/vip96.aacp",
      "Organic": "https://radiorecord.hostingradio.ru/organic96.aacp",
      "Black Rap": "https://radiorecord.hostingradio.ru/yo96.aacp",
      "D'n'B Classics": "https://radiorecord.hostingradio.ru/drumhits96.aacp",
      "EDM": "https://radiorecord.hostingradio.ru/club96.aacp"
    };

    const audio = document.getElementById('radio');
    const select = document.getElementById('channelSelect');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const stopBtn = document.getElementById('stopBtn');
    const volume = document.getElementById('volume');
    const status = document.getElementById('status');

    const waveCtx = document.getElementById('waveCanvas').getContext('2d');
    const freqCtx = document.getElementById('freqCanvas').getContext('2d');
    const bufferCtx = document.getElementById('bufferCanvas').getContext('2d');

    let audioContext, analyser, source, dataArray, freqArray, bufferData = [];

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ select + –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ localStorage
    Object.entries(channels).forEach(([name, url]) => {
      const opt = document.createElement('option');
      opt.value = url;
      opt.textContent = name;
      select.appendChild(opt);
    });
    const saved = localStorage.getItem('lastChannel');
    if (saved && Object.values(channels).includes(saved)) select.value = saved;
    audio.src = select.value;

    select.addEventListener('change', () => {
      audio.pause();
      audio.src = select.value;
      audio.load();
      localStorage.setItem('lastChannel', select.value);
      status.textContent = `üîÅ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ: ${select.selectedOptions[0].text}`;
    });

    function setupAudioAnalyzer() {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      source = audioContext.createMediaElementSource(audio);
      source.connect(analyser);
      analyser.connect(audioContext.destination);
      analyser.fftSize = 1024;
      dataArray = new Uint8Array(analyser.fftSize);
      freqArray = new Uint8Array(analyser.frequencyBinCount);
    }

    function drawAll() {
      requestAnimationFrame(drawAll);

      analyser.getByteTimeDomainData(dataArray);
      waveCtx.clearRect(0, 0, waveCtx.canvas.width, waveCtx.canvas.height);
      waveCtx.beginPath();
      let slice = waveCtx.canvas.width / dataArray.length, x = 0;
      for (let i = 0; i < dataArray.length; i++) {
        let y = (dataArray[i] / 128.0) * waveCtx.canvas.height / 2;
        i ? waveCtx.lineTo(x, y) : waveCtx.moveTo(x, y);
        x += slice;
      }
      waveCtx.strokeStyle = "#0f0";
      waveCtx.stroke();

      analyser.getByteFrequencyData(freqArray);
      freqCtx.clearRect(0, 0, freqCtx.canvas.width, freqCtx.canvas.height);
      let barWidth = 2, x2 = 0;
      for (let i = 0; i < freqArray.length; i++) {
        let h = freqArray[i] / 2;
        freqCtx.fillStyle = 'lime';
        freqCtx.fillRect(x2, freqCtx.canvas.height - h, barWidth, h);
        x2 += barWidth + 1;
      }

      bufferCtx.clearRect(0, 0, bufferCtx.canvas.width, bufferCtx.canvas.height);
      bufferCtx.beginPath();
      bufferCtx.moveTo(0, bufferCtx.canvas.height);
      for (let i = 0; i < bufferData.length; i++) {
        let y = bufferCtx.canvas.height - (bufferData[i] * bufferCtx.canvas.height);
        bufferCtx.lineTo(i * (bufferCtx.canvas.width / 100), y);
      }
      bufferCtx.strokeStyle = "#0f0";
      bufferCtx.stroke();
    }

    playBtn.addEventListener('click', () => {
      audio.play();
      if (!audioContext) {
        setupAudioAnalyzer();
        drawAll();
      }
      status.textContent = "‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ";
    });

    pauseBtn.addEventListener('click', () => {
      audio.pause();
      status.textContent = "‚è∏Ô∏è –ü–∞—É–∑–∞";
    });

    stopBtn.addEventListener('click', () => {
      audio.pause();
      audio.currentTime = 0;
      status.textContent = "‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
    });

    volume.addEventListener('input', () => {
      audio.volume = volume.value;
    });

    audio.addEventListener('waiting', () => {
      bufferData.push(1);
      if (bufferData.length > 100) bufferData.shift();
    });

    audio.addEventListener('playing', () => {
      bufferData.push(0);
      if (bufferData.length > 100) bufferData.shift();
    });

    setInterval(() => {
      if (!audio.paused && audio.readyState > 2) {
        bufferData.push(0);
        if (bufferData.length > 100) bufferData.shift();
      }
    }, 1000);
  </script>
</body>
</html>
